# Docs for the Azure Web Apps Deploy action: https://github.com/Azure/webapps-deploy
# More GitHub Actions for Azure: https://github.com/Azure/actions

- name: Copy artifact for deployment job
  run: |
    mkdir -p deploy
    if [ -d ".next/standalone" ]; then
      cp -r .next/standalone/ ./deploy
    else
      echo ".next/standalone directory not found"
    fi

    if [ -d "public" ]; then
      cp -r public ./deploy
    else
      echo "public directory not found, skipping"
    fi

    if [ -d ".next/static" ]; then
      mkdir -p ./deploy/.next/static
      cp -r .next/static/. ./deploy/.next/static
    else
      echo ".next/static directory not found"
    fi

    cp package.json ./deploy/ || echo "package.json not found"
    cp next.config.mjs ./deploy/ || echo "next.config.mjs not found"

# このステップは、デプロイに必要なファイルを"deploy"ディレクトリにコピーします。
# Next.jsプロジェクトの場合、standaloneディレクトリ、publicディレクトリ、staticファイル、package.json、next.config.mjsをコピーします。
# ディレクトリやファイルが存在しない場合は、エラーメッセージを表示します。

- name: Zip artifact for deployment
  run: zip release.zip ./deploy -r

# このステップでは、"deploy"ディレクトリの内容を"release.zip"というZIPファイルに圧縮します。
# `-r`オプションは、ディレクトリを再帰的に圧縮することを意味します。
